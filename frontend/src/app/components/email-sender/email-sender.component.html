<mat-card>
  <mat-card-header>
    <mat-card-title>Enviar Correo</mat-card-title>
  </mat-card-header>
  <mat-card-content>
    <form [formGroup]="emailForm" (ngSubmit)="sendEmail()">
      <mat-form-field appearance="fill" class="full-width">
        <mat-label>Para</mat-label>
        <mat-chip-grid #toChipGrid aria-label="Destinatarios 'Para'">
          @for (recipient of toRecipients; track recipient) {
            <mat-chip-row (removed)="removeRecipient(recipient, 'to')">
              {{recipient.email}}
              <button matChipRemove [attr.aria-label]="'remove ' + recipient.email">
                <mat-icon>cancel</mat-icon>
              </button>
            </mat-chip-row>
          }
          <input
            placeholder="Añadir destinatario..."
            [formControl]="toCtrl"
            [matChipInputFor]="toChipGrid"
            [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
            (matChipInputTokenEnd)="addRecipient($event, 'to')">
        </mat-chip-grid>
        <button mat-icon-button matSuffix (click)="loadToRecipients()">
          <mat-icon>group_add</mat-icon>
        </button>
      </mat-form-field>

      <mat-form-field appearance="fill" class="full-width">
        <mat-label>Cc</mat-label>
        <mat-chip-grid #ccChipGrid aria-label="Destinatarios 'Cc'">
          @for (recipient of ccRecipients; track recipient) {
            <mat-chip-row (removed)="removeRecipient(recipient, 'cc')">
              {{recipient.email}}
              <button matChipRemove [attr.aria-label]="'remove ' + recipient.email">
                <mat-icon>cancel</mat-icon>
              </button>
            </mat-chip-row>
          }
          <input
            placeholder="Añadir Cc..."
            [formControl]="ccCtrl"
            [matChipInputFor]="ccChipGrid"
            [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
            (matChipInputTokenEnd)="addRecipient($event, 'cc')">
        </mat-chip-grid>
        <button mat-icon-button matSuffix (click)="loadCcRecipients()">
          <mat-icon>group_add</mat-icon>
        </button>
      </mat-form-field>

      <mat-form-field appearance="fill" class="full-width">
        <mat-label>Bcc</mat-label>
        <mat-chip-grid #bccChipGrid aria-label="Destinatarios 'Bcc'">
          @for (recipient of bccRecipients; track recipient) {
            <mat-chip-row (removed)="removeRecipient(recipient, 'bcc')">
              {{recipient.email}}
              <button matChipRemove [attr.aria-label]="'remove ' + recipient.email">
                <mat-icon>cancel</mat-icon>
              </button>
            </mat-chip-row>
          }
          <input
            placeholder="Añadir Bcc..."
            [formControl]="bccCtrl"
            [matChipInputFor]="bccChipGrid"
            [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
            (matChipInputTokenEnd)="addRecipient($event, 'bcc')">
        </mat-chip-grid>
        <button mat-icon-button matSuffix (click)="loadBccRecipients()">
          <mat-icon>group_add</mat-icon>
        </button>
      </mat-form-field>

      <mat-form-field appearance="fill" class="full-width">
        <mat-label>Asunto</mat-label>
        <input matInput formControlName="subject" placeholder="Asunto del correo">
        <mat-error *ngIf="emailForm.get('subject')?.hasError('required')">
          El asunto es requerido.
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="fill" class="full-width">
        <mat-label>Cuerpo del Correo (usa  para marcadores)</mat-label>
        <textarea matInput formControlName="bodyTemplate" placeholder="Hola {NOMBRE}, tu DNI es {DNI}"></textarea>
        <mat-hint>Ejemplo: "Estimado(a) "</mat-hint>
        <mat-error *ngIf="emailForm.get('bodyTemplate')?.hasError('required')">
          El cuerpo del correo es requerido.
        </mat-error>
      </mat-form-field>

      <mat-checkbox formControlName="sendIndividual">
        Enviar un correo individual a cada destinatario (personalizado)
      </mat-checkbox>

      <div class="button-row">
        <button mat-raised-button color="primary" type="submit" [disabled]="emailForm.invalid || toRecipients.length === 0">
          Enviar Correo
        </button>
        <button mat-raised-button color="warn" type="button" (click)="resetForm()">
          Limpiar
        </button>
      </div>
    </form>
  </mat-card-content>
</mat-card>
